<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quên Mật Khẩu</title>
    
    <link rel="stylesheet" href="../css/style.css"> 
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

    <header class="navbar">
        <div class="navbar-container">
            <a href="../index.html" class="navbar-logo">C1SE.60</a>
            <nav class="navbar-links">
                <ul>
                    <li><a href="#"><i class="fa-solid fa-newspaper fa-fw"></i> Tin Tuyển Dụng</a></li>
                    <li><a href="#"><i class="fa-solid fa-address-card fa-fw"></i> Hồ Sơ Ứng Viên</a></li>
                    <li><a href="#"><i class="fa-solid fa-lightbulb fa-fw"></i> Tin Tức</a></li>
                </ul>
            </nav>
            <div class="navbar-buttons">
                <a href="#" class="nav-button btn-secondary"><i class="fa-solid fa-upload fa-fw"></i> Đăng Tin Tuyển Dụng</a>
                <a href="#" class="nav-button btn-primary"><i class="fa-solid fa-plus fa-fw"></i> Tạo Hồ Sơ Việc Làm</a>
                <div class="nav-auth-links">
                    <a href="./login.html">Đăng Nhập</a> 
                    <span>/</span>
                    <a href="./register.html">Đăng Ký</a> 
                </div>
            </div>
            <button class="navbar-toggle" id="navbarToggle" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="navbar-mobile-menu" id="navbarMobileMenu">
            <nav class="navbar-links-mobile">
                <ul>
                    <li><a href="#"><i class="fa-solid fa-newspaper fa-fw"></i> Tin Tuyển Dụng</a></li>
                    <li><a href="#"><i class="fa-solid fa-address-card fa-fw"></i> Hồ Sơ Ứng Viên</a></li>
                    <li><a href="#"><i class="fa-solid fa-lightbulb fa-fw"></i> Tin Tức</a></li>
                </ul>
            </nav>
            <div class="navbar-buttons-mobile">
                <a href="#" class="nav-button btn-secondary"><i class="fa-solid fa-upload fa-fw"></i> Đăng Tin Tuyển Dụng</a>
                <a href="#" class="nav-button btn-primary"><i class="fa-solid fa-plus fa-fw"></i> Tạo Hồ Sơ Việc Làm</a>
            </div>
            <div class="nav-auth-links-mobile">
                <a href="./login.html">Đăng Nhập</a>
                <span>/</span>
                <a href="./register.html">Đăng Ký</a>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="form-container">
            <h2>Quên Mật Khẩu</h2>
            <p class="form-header-text">Nhập email của bạn để nhận hướng dẫn đặt lại mật khẩu.</p>

            <form id="forgot-password-form"> 

                <div class="input-group">
                    <i class="fa-solid fa-envelope fa-fw"></i>
                    <label for="email">Email (*)</label>
                    <input type="email" id="email" name="email" placeholder="Nhập email đã đăng ký" required>
                </div>

                <button type="submit">Gửi Hướng Dẫn</button>
                <p id="response-message" class="alert" style="display: none; margin-top: 1rem;"></p>
            </form>
            <div class="form-link">
                <p><a href="./login.html">Quay lại Đăng nhập</a></p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        
        // Helper function to display messages
        const displayMessage = (message, isSuccess) => {
            responseMessage.textContent = message;
            responseMessage.className = isSuccess ? 'alert alert-success' : 'alert alert-danger';
            responseMessage.style.display = 'block';
        };
        
        // --- Xử lý menu mobile (Đã hoàn thiện logic) ---
        const navbarToggle = document.getElementById('navbarToggle');
        const navbarMobileMenu = document.getElementById('navbarMobileMenu');
        
        if (navbarToggle && navbarMobileMenu) {
            navbarToggle.addEventListener('click', function() {
                navbarMobileMenu.classList.toggle('active');
                const icon = navbarToggle.querySelector('i');
                if (icon) {
                    icon.classList.toggle('fa-bars');
                    icon.classList.toggle('fa-times');
                }
            });
        }
        
        // --- Xử lý Submit Form Quên Mật Khẩu ---
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const responseMessage = document.getElementById('response-message');
        const submitButton = forgotPasswordForm ? forgotPasswordForm.querySelector('button[type="submit"]') : null;

        if (forgotPasswordForm) {
            forgotPasswordForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                responseMessage.style.display = 'none';

                const formData = new FormData(forgotPasswordForm);
                const data = Object.fromEntries(formData.entries());
                
                // VÔ HIỆU HÓA NÚT SUBMIT
                if (submitButton) {
                    submitButton.disabled = true;
                    submitButton.textContent = 'Đang gửi...';
                }

                // SỬ DỤNG URL API ĐẦY ĐỦ (API chạy trên cổng 5000)
                const apiEndpoint = 'http://localhost:5000/api/auth/forgot-password';

                try {
                    const response = await fetch(apiEndpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: data.email }),
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        // Yêu cầu thành công
                        displayMessage(result.message || 'Hướng dẫn đặt lại mật khẩu đã được gửi đến email của bạn.', true);
                        forgotPasswordForm.reset(); 
                    } else {
                        // Hiển thị lỗi từ backend
                        displayMessage(result.message || 'Gửi yêu cầu thất bại. Email không tồn tại hoặc đã xảy ra lỗi.', false);
                    }
                } catch (error) {
                    console.error('Lỗi khi gửi form quên mật khẩu:', error);
                    displayMessage('Đã xảy ra lỗi kết nối. Vui lòng kiểm tra Server API (Cổng 5000).', false);
                } finally {
                    // KÍCH HOẠT LẠI NÚT SUBMIT
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Gửi Hướng Dẫn';
                    }
                }
            });
        }
    });
    </script>

</body>
</html>